import os
import google.generativeai as genai

# ุชููุฆุฉ ููุชุงุญ Gemini API ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
genai.configure(api_key=os.getenv("AI_API_KEY"))

# ุฅูุดุงุก ูููุฐุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ููููู ูุงุญููุง ุชุบููุฑู ุฅูู gemini-1.5-pro)
model = genai.GenerativeModel("gemini-1.5-flash")


# -----------------------------------------------------
# ๐น ุฏุงูุฉ ุชูููุฏ ูุตู ูููุชุงุจ ุจูุงุกู ุนูู ุนููุงูู
# -----------------------------------------------------
async def generate_book_description(book_title: str) -> str:
    """
    ุชููููุฏ ูุตููุง ููุฌุฒูุง ูุงุญุชุฑุงูููุง ููุชุงุจ ูุนููู ุนุจุฑ Gemini AI.
    """
    try:
        prompt = (
            f"ุงูุชุจ ูุตููุง ูุตูุฑูุง ูุฌุฐุงุจูุง ููุชุงุจ ุจุนููุงู '{book_title}'. "
            "ุงุดุฑุญ ููุฑุชู ุงูุฃุณุงุณูุฉ ูุฃูู ูุง ููุฏููู ุฏูู ูุจุงูุบุฉ."
        )
        response = model.generate_content(prompt)
        return response.text.strip() if response.text else "ูู ุฃุฌุฏ ูุตููุง ูุชุงุญูุง ููุฐุง ุงููุชุงุจ."
    except Exception as e:
        print(f"[AI ERROR] ุฃุซูุงุก ุชูููุฏ ูุตู ุงููุชุงุจ: {e}")
        return "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชูููุฏ ุงููุตู."


# -----------------------------------------------------
# ๐น ุฏุงูุฉ ุงูุชุฑุงุญ ูุชุจ ูุดุงุจูุฉ ุจูุงุกู ุนูู ุงููุคูู ุฃู ุงูููุถูุน
# -----------------------------------------------------
async def suggest_related_books(topic: str) -> str:
    """
    ุชููุชุฑุญ ูุชุจูุง ุฃุฎุฑู ูุดุงุจูุฉ ุจูุงุกู ุนูู ููุถูุน ุฃู ูุคูู ูุนููู.
    """
    try:
        prompt = (
            f"ุงูุชุฑุญ ูู ุฎูุณุฉ ูุชุจ ุฑุงุฆุนุฉ ุชุชูุงูู ููุถูุน '{topic}'ุ "
            "ูุงูุชุจูุง ููุงุฆูุฉ ุจุฃุณูุงุฆูุง ููุทุ ุฏูู ุดุฑุญ ุฃู ุฃุฑูุงู ุฒุงุฆุฏุฉ."
        )
        response = model.generate_content(prompt)
        return response.text.strip() if response.text else "ูู ุฃุฌุฏ ูุชุจูุง ูุดุงุจูุฉ."
    except Exception as e:
        print(f"[AI ERROR] ุฃุซูุงุก ุงูุชุฑุงุญ ุงููุชุจ: {e}")
        return "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุฑุงุญ ุงููุชุจ."


# -----------------------------------------------------
# ๐น ุฏุงูุฉ ุงูุจุญุซ ุงูุฐูู ุนู ูุชุงุจ ุนุจุฑ ุงููุตุฉ ุฃู ุงููุตู
# -----------------------------------------------------
async def search_by_story_or_description(query: str) -> str:
    """
    ูุญุงูู ุชุฎููู ุงุณู ุงููุชุงุจ ุจูุงุกู ุนูู ูุตุฉ ุฃู ูุตู ุงููุณุชุฎุฏู.
    """
    try:
        prompt = (
            f"ุจูุงุกู ุนูู ูุฐุง ุงููุตู ุฃู ุงููุตุฉ:\n'{query}'\n"
            "ูุง ูู ุงููุชุงุจ ุงูุฃูุฑุจ ููุฐุง ุงููุตูุ ุงูุชุจ ุงูุงุณู ุงูุฃูุซุฑ ุงุญุชูุงูุงู ููุท ุฏูู ุดุฑุญ."
        )
        response = model.generate_content(prompt)
        return response.text.strip() if response.text else "ูู ุฃุชููู ูู ุชุญุฏูุฏ ุงููุชุงุจ ุงูููุตูุฏ."
    except Exception as e:
        print(f"[AI ERROR] ุฃุซูุงุก ุงูุจุญุซ ุนุจุฑ ุงููุตุฉ: {e}")
        return "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุจุญุซ."
