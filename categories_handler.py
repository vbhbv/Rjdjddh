# -----------------------------
# ุฌุฏูู ุงูููุฑุณ ูุงููุฆุงุช ุงููุชุนุฏุฏุฉ
# -----------------------------

# ูุฌุจ ุงูุชุฃูุฏ ูู ูุฌูุฏ conn = context.bot_data.get("db_conn")

async def init_categories(conn):
    """
    ุฅูุดุงุก ุฌุฏูู ุงูููุฑุณ ูุฅุฏุฎุงู ุงููุฆุงุช ุงูุฑุฆูุณูุฉ ูุน ุงููููุงุช ุงูููุชุงุญูุฉ
    """
    # ุฅูุดุงุก ุฌุฏูู categories
    await conn.execute("""
    CREATE TABLE IF NOT EXISTS categories (
        id SERIAL PRIMARY KEY,
        name TEXT NOT NULL UNIQUE,
        keywords TEXT[] NOT NULL
    );
    """)

    # ูุงุฆูุฉ ุงููุฆุงุช ูุงููููุงุช ุงูููุชุงุญูุฉ
    categories = [
        ("ููุงุนุฏ ุงููุบุฉ ุงูุนุฑุจูุฉ", ["ููุงุนุฏ", "ูุญู", "ุตุฑู", "ุฅููุงุก"]),
        ("ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ", ["english", "grammar", "vocabulary"]),
        ("ุงููุงููู", ["ูุงููู", "ุชุดุฑูุน", "ุญููู", "ูุญููุฉ"]),
        ("ุงูุดุนุฑ", ["ุดุนุฑ", "ุดุงุนุฑ", "ูุตูุฏุฉ", "ุฏููุงู"]),
        ("ุงูููุฏ ุงูุฃุฏุจู", ["ููุฏ", "ุชุญููู ุฃุฏุจู", "ุฃุฏุจ", "ุฏุฑุงุณุฉ"]),
        ("ุงูููุฒูุงุก", ["ููุฒูุงุก", "ููุฑููุบูุงุทูุณูุฉ", "ูููุงูููุง", "ููุงูุชู"]),
        ("ุงูููููุงุก", ["ููููุงุก", "ุนุถููุฉ", "ูุงุนุถููุฉ", "ุชุญููู"]),
        ("ุงูุฑูุงุถูุงุช", ["ุฑูุงุถูุงุช", "ููุฏุณุฉ", "ุฌุจุฑ", "ุงุญุตุงุก"]),
        ("ุงูููุณูุฉ", ["ููุณูุฉ", "ููุชุงููุฒูููุง", "ุงุฎูุงู", "ููุทู"]),
        ("ุงูุชุงุฑูุฎ", ["ุชุงุฑูุฎ", "ุญุถุงุฑุฉ", "ุนุตูุฑ", "ุญุฑูุจ"]),
        ("ุงูุฌุบุฑุงููุง", ["ุฌุบุฑุงููุง", "ุฎุฑุงุฆุท", "ููุงุฎ", "ุจูุฆุฉ"]),
        ("ุนูู ุงูููุณ", ["ุนูู ุงูููุณ", "ุณููู", "ุนูู", "ููุณ"]),
        ("ุงูุงูุชุตุงุฏ", ["ุงูุชุตุงุฏ", "ูุงููุฉ", "ุชุฌุงุฑุฉ", "ุณูู"]),
        ("ุงูุฅุฏุงุฑุฉ", ["ุฅุฏุงุฑุฉ", "ุชูุธูู", "ูุดุงุฑูุน", "ููุงุฏุฉ"]),
        ("ุนููู ุงูุญุงุณูุจ", ["ุจุฑูุฌุฉ", "ุฎูุงุฑุฒููุงุช", "ุดุจูุงุช", "ุฐูุงุก ุงุตุทูุงุนู"]),
        ("ุงูุทุจ", ["ุทุจ", "ุฃุฏููุฉ", "ุชุดุฎูุต", "ุนูุงุฌ"]),
        ("ุงูุตุญุฉ ุงูุนุงูุฉ", ["ุตุญุฉ", "ุชุบุฐูุฉ", "ุทุจ ููุงุฆู", "ูุจุงุก"]),
        ("ุงูููุฏุณุฉ ุงููุฏููุฉ", ["ููุฏุณุฉ ูุฏููุฉ", "ุฅูุดุงุกุงุช", "ุชุตููู", "ูุดุงุฑูุน"]),
        ("ุงูููุฏุณุฉ ุงูููุฑุจุงุฆูุฉ", ["ููุฏุณุฉ ููุฑุจุงุฆูุฉ", "ุฏูุงุฆุฑ", "ุงููุชุฑูููุงุช"]),
        ("ุงูููุฏุณุฉ ุงููููุงููููุฉ", ["ูููุงูููุง", "ูุญุฑูุงุช", "ุฏููุงูููุง"]),
        ("ุนูู ุงูุงุฌุชูุงุน", ["ุนูู ุงูุงุฌุชูุงุน", "ูุฌุชูุน", "ุซูุงูุฉ", "ุณููู"]),
        ("ุงูุฏูู ูุงูุฏุฑุงุณุงุช ุงูุฅุณูุงููุฉ", ["ุฏูู", "ุฅุณูุงู", "ููู", "ุญุฏูุซ"]),
        ("ุงูุณูุงุณุฉ", ["ุณูุงุณุฉ", "ุญูููุฉ", "ุฏุจูููุงุณูุฉ", "ุงูุชุฎุงุจุงุช"]),
        ("ุงูุฃุฏุจ ุงูุนุฑุจู", ["ุฃุฏุจ", "ุฑูุงูุฉ", "ูุตุฉ", "ูุต"]),
        ("ุงูุฃุฏุจ ุงูุนุงููู", ["literature", "novel", "story", "poetry"]),
        ("ุงููููู", ["ูู", "ุฑุณู", "ููุณููู", "ุชูุซูู"]),
        ("ุงูุจูุฆุฉ", ["ุจูุฆุฉ", "ุชููุซ", "ููุงุฎ", "ุทุจูุนุฉ"]),
        ("ุงูุณูุงุญุฉ ูุงูุณูุฑ", ["ุณูุงุญุฉ", "ุฑุญูุฉ", "ูุฌูุฉ", "ุณูุฑ"]),
        ("ุงูุฑูุงุถุฉ", ["ุฑูุงุถุฉ", "ูุฑุฉ ูุฏู", "ุณุจุงู", "ุชูุงุฑูู"]),
        ("ุงูุชูููุฉ ูุงูุงุฎุชุฑุงุนุงุช", ["ุชูููุฉ", "ุงุฎุชุฑุงุน", "ุงุจุชูุงุฑ", "ุชูููููุฌูุง"])
    ]

    # ุฅุฏุฎุงู ุงููุฆุงุช ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
    for name, keywords in categories:
        try:
            await conn.execute("""
            INSERT INTO categories (name, keywords)
            VALUES($1, $2)
            ON CONFLICT (name) DO NOTHING;
            """, name, keywords)
        except Exception as e:
            print(f"โ Failed to insert category {name}: {e}")

# -----------------------------
# ุฏุงูุฉ ุงุณุชุฑุฌุงุน ุงูููุฑุณ ูุนุฑุถ ุงูุฃุฒุฑุงุฑ
# -----------------------------

from telegram import InlineKeyboardButton, InlineKeyboardMarkup

async def send_category_buttons(update, context):
    conn = context.bot_data.get("db_conn")
    if not conn:
        await update.message.reply_text("โ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุตูุฉ.")
        return

    rows = await conn.fetch("SELECT id, name FROM categories ORDER BY id;")
    keyboard = []
    for row in rows:
        keyboard.append([InlineKeyboardButton(row["name"], callback_data=f"category:{row['id']}")])

    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text(
        "๐ ููุฑุณ ุงูููุชุจุฉ ุญุณุจ ุงูุชุตูููุงุช:",
        reply_markup=reply_markup
    )
